/**
 * SciAnimator - Scientific Image Animator Plugin for jQuery
 *
 * Copyright (c) 2010 Brent Ertz
 * Released under the MIT license.
 * http://github.com/brentertz/scianimator
*/
(function(e){var c={CONTROLS_ALL:"all",CONTROLS_NONE:"none",DIRECTION_FORWARD:0,DIRECTION_REVERSE:1,LOOP_MODE_NONE:"none",LOOP_MODE_LOOP:"loop",LOOP_MODE_SWEEP:"sweep",PLAY_MODE_STOPPED:0,PLAY_MODE_PLAYING:1,POSITION_TOP:0,POSITION_BOTTOM:1};e.fn.scianimator=function(f){if(b[f]){return b[f].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof f==="object"||!f){return b.init.apply(this,arguments)}else{e.error("Method "+f+" does not exist on jQuery.scianimator")}}};e.fn.scianimator.defaults={debug:false,images:[],controlContainer:null,controlPosition:c.POSITION_BOTTOM,controls:c.CONTROLS_ALL,defaultFrame:0,delay:500,delayStep:250,delayMin:25,delayMax:5000,dwellMultiplier:2,height:600,width:600,theme:"light",utf8:true,loopMode:c.LOOP_MODE_LOOP,labels:{text:{first:"First",previous:"Previous",play:"Play",stop:"Stop",next:"Next",last:"Last",loop:{tip:"Click to toggle loop mode",loop:"Loop",sweep:"Sweep",none:"None"},speed:{speed:"Speed",down:"-",up:"+"},navigator:{tip:"Click to go to frame; &lt;ctrl&gt;+click to enable/disable frame."},status:{preload:"Preloading images..."}},utf8:{first:"|&#8592;",previous:"&#8592;",play:"&#9658;",stop:"&#9632;",next:"&#8594;",last:"&#8594;|"}}};var d={};var b={init:function(f){d=e.extend(true,{},e.fn.scianimator.defaults,f);a("init");return this.each(function(){var h=e(this);var g=h.data("scianimator");e(this).data("scianimator",{id:h[0].id,target:h,context:null,animationTimer:null,playMode:c.PLAY_MODE_STOPPED,frames:[],currentFrame:d.defaultFrame,firstFrame:0,lastFrame:null,disabledFrames:[],direction:c.DIRECTION_FORWARD,dwell:0,settings:d,controls:{}});h.scianimator("preload").scianimator("container").scianimator("canvas").scianimator("controls").scianimator("calculateDwell")})},destroy:function(){a("destroy");return this.each(function(){var g=e(this);var f=g.data("scianimator");e(window).unbind(".scianimator");g.removeData("scianimator");window.clearTimeout(f.animationTimer);g.remove()})},drawImage:function(i){a("drawImage");var h=e(this);var f=h.data("scianimator");i=parseInt(i,10);var g=f.frames[i];e("<img />").load(function(){f.context.drawImage(this,0,0)}).error(function(){a("Image failed to load for frame #"+i+" : "+g.src);h.scianimator("enableDisable",{frame:i,state:"disable"})}).attr("src",g.src);return h},container:function(){a("container");var g=e(this);var f=g.data("scianimator");g.addClass("scianimator").css("width",f.settings.width);if(f.settings.theme!==undefined){g.addClass(f.settings.theme)}return g},canvas:function(){a("canvas");var h=e(this);var g=h.data("scianimator");var f=e("<canvas />").attr("width",g.settings.width).attr("height",g.settings.height);h.append(f[0]);if(e.browser.msie&&e.browser.version<9){G_vmlCanvasManager.initElement(f[0])}if(f[0].getContext){g.context=f[0].getContext("2d");if("number"===typeof g.settings.defaultFrame){h.scianimator("goto",g.settings.defaultFrame)}else{if("last"===g.settings.defaultFrame){h.scianimator("last")}else{h.scianimator("first")}}}return h},controls:function(){a("controls");var j=e(this);var i=j.data("scianimator");var g=e('<div id="'+i.id+'-controls" class="scianimator controls"></div>');if(i.settings.theme!==undefined){g.addClass(i.settings.theme)}var h=e("<form></form>");var f={first:function(){var k=(i.settings.utf8)?i.settings.labels.utf8.first:i.settings.labels.text.first;return e('<a id="'+i.id+'-first" class="control first" href="#">'+k+"</a>")},previous:function(){var k=(i.settings.utf8)?i.settings.labels.utf8.previous:i.settings.labels.text.previous;return e('<a id="'+i.id+'-previous" class="control previous" href="#">'+k+"</a>")},play:function(){var k=(i.settings.utf8)?i.settings.labels.utf8.play:i.settings.labels.text.play;return e('<a id="'+i.id+'-play" class="control play" href="#">'+k+"</a>")},next:function(){var k=(i.settings.utf8)?i.settings.labels.utf8.next:i.settings.labels.text.next;return e('<a id="'+i.id+'-next" class="control next" href="#">'+k+"</a>")},last:function(){var k=(i.settings.utf8)?i.settings.labels.utf8.last:i.settings.labels.text.last;return e('<a id="'+i.id+'-last" class="control last" href="#">'+k+"</a>")},navigator:function(){var k=e('<span id="'+i.id+'-navigator" class="control navigator box"></span>');var l=i.settings.labels.text.navigator.tip;e.each(i.frames,function(m,n){k.append('<a id="'+i.id+"-navigator-"+m+'" title="'+l+'" href="#" class="control navigator">&nbsp;</a>')});return k},loop:function(){var k=(i.settings.utf8&&i.settings.labels.utf8.loop!==undefined)?i.settings.labels.utf8.loop[i.settings.loopMode]:i.settings.labels.text.loop[i.settings.loopMode];var l=i.settings.labels.text.loop.tip;return e('<a id="'+i.id+'-loop" class="control loop '+i.settings.loopMode+'" title="'+l+'" href="#">'+k+"</a>")},speed:function(){var l=(i.settings.utf8&&i.settings.labels.utf8.speed!==undefined)?i.settings.labels.utf8.speed.speed:i.settings.labels.text.speed.speed;var k=(i.settings.utf8&&i.settings.labels.utf8.speed!==undefined)?i.settings.labels.utf8.speed.up:i.settings.labels.text.speed.up;var m=(i.settings.utf8&&i.settings.labels.utf8.speed!==undefined)?i.settings.labels.utf8.speed.down:i.settings.labels.text.speed.down;return e('<span id="'+i.id+'-speed" class="control speed box"><a id="'+i.id+'-speed-down" class="control speed-down small" href="#">'+m+"</a> <label>"+l+'</label> <a id="'+i.id+'-speed-up" class="control speed-up small" href="#">'+k+"</a></span>")}};g.delegate("form","submit",function(k){k.preventDefault()}).delegate("a","click",function(k){k.preventDefault();switch(k.target.id){case i.id+"-first":j.scianimator("first");break;case i.id+"-previous":j.scianimator("previous");break;case i.id+"-play":j.scianimator("playOrStop");break;case i.id+"-next":j.scianimator("next");break;case i.id+"-last":j.scianimator("last");break;case i.id+"-loop":j.scianimator("loopMode");break;case i.id+"-speed-down":j.scianimator("speedDown");break;case i.id+"-speed-up":j.scianimator("speedUp");break}}).delegate("a.navigator","click",function(k){k.preventDefault();var m=i.id+"-navigator-";if((k.target.id).indexOf(m)!=-1){var l=parseInt((k.target.id).substring(m.length),10);if(k.metaKey){j.scianimator("enableDisable",{frame:l})}else{j.scianimator("goto",l)}}});if(e.isArray(i.settings.controls)&&i.settings.controls.length>0){e.each(i.settings.controls,function(k,l){h.append(f[l]);i.controls[l]=f[l]()[0].id})}else{if(c.CONTROLS_ALL===i.settings.controls){e.each(f,function(k,l){h.append(l);i.controls[k]=l()[0].id})}else{a("Display no controls")}}if(!e(h).is(":empty")){g.append(h);if(i.settings.controlContainer!==null){if(c.POSITION_TOP===i.settings.controlPosition){e(i.settings.controlContainer).prepend(container)}else{e(i.settings.controlContainer).append(container)}}else{if(c.POSITION_TOP===i.settings.controlPosition){j.prepend(g)}else{j.append(g)}}}j.scianimator("onControlsComplete");return j},onControlsComplete:function(){a("onControlsComplete");var g=e(this);var f=g.data("scianimator");g.scianimator("hilightCurrent")},playOrStop:function(){a("playOrStop");var g=e(this);var f=g.data("scianimator");if(c.PLAY_MODE_PLAYING===f.playMode){g.scianimator("stop")}else{if(c.PLAY_MODE_STOPPED===f.playMode){g.scianimator("play")}}return g},play:function(){a("play");var i=e(this);var h=i.data("scianimator");h.playMode=c.PLAY_MODE_PLAYING;var g=h.settings.delay;if(c.DIRECTION_FORWARD===h.direction){if(h.currentFrame===h.firstFrame||h.currentFrame===h.lastFrame){g=h.dwell}}a("delay: "+g);h.animationTimer=self.setTimeout(function(){i.scianimator("animate")},g);var f=(h.settings.utf8)?h.settings.labels.utf8.stop:h.settings.labels.text.stop;e("#"+h.controls.play).removeClass("play").addClass("stop").html(f);return i},stop:function(){a("stop");var h=e(this);var g=h.data("scianimator");g.animationTimer=window.clearTimeout(g.animationTimer);g.playMode=c.PLAY_MODE_STOPPED;var f=(g.settings.utf8)?g.settings.labels.utf8.play:g.settings.labels.text.play;e("#"+g.controls.play).removeClass("stop").addClass("play").html(f);return h},animate:function(){a("animate");var g=e(this);var f=g.data("scianimator");if(c.DIRECTION_FORWARD===f.direction){g.scianimator("next")}else{if(c.DIRECTION_REVERSE===f.direction){g.scianimator("previous")}}if(c.PLAY_MODE_PLAYING===f.playMode){g.scianimator("play")}return g},previous:function(){a("previous");var g=e(this);var f=g.data("scianimator");f.currentFrame--;if(e.inArray(f.currentFrame,f.disabledFrames)!=-1){g.scianimator("previous");return g}a(f.firstFrame+":"+f.currentFrame+":"+f.lastFrame);if(f.currentFrame<f.firstFrame){if(c.PLAY_MODE_PLAYING===f.playMode){if(c.LOOP_MODE_LOOP===f.settings.loopMode){g.scianimator("last")}else{if(c.LOOP_MODE_SWEEP===f.settings.loopMode){f.direction=c.DIRECTION_FORWARD;g.scianimator("next")}else{if(c.LOOP_MODE_NONE===f.settings.loopMode){g.scianimator("stop")}}}}else{if(c.PLAY_MODE_STOPPED===f.playMode){g.scianimator("last")}}}else{g.scianimator("goto",f.currentFrame)}return g},next:function(){a("next");var g=e(this);var f=g.data("scianimator");f.currentFrame++;a(f.firstFrame+":"+f.currentFrame+":"+f.lastFrame);if(e.inArray(f.currentFrame,f.disabledFrames)!=-1){g.scianimator("next");return g}if(f.currentFrame>f.lastFrame){if(c.PLAY_MODE_PLAYING===f.playMode){if(c.LOOP_MODE_LOOP===f.settings.loopMode){g.scianimator("first")}else{if(c.LOOP_MODE_SWEEP===f.settings.loopMode){f.direction=c.DIRECTION_REVERSE;g.scianimator("previous")}else{if(c.LOOP_MODE_NONE===f.settings.loopMode){g.scianimator("stop")}}}}else{if(c.PLAY_MODE_STOPPED===f.playMode){g.scianimator("first")}}}else{g.scianimator("goto",f.currentFrame)}return g},first:function(){a("first");var g=e(this);var f=g.data("scianimator");g.scianimator("goto",f.firstFrame);return g},last:function(){a("last");var g=e(this);var f=g.data("scianimator");g.scianimator("goto",f.lastFrame);return g},"goto":function(h){a("goto");var g=e(this);var f=g.data("scianimator");var h=parseInt(h,10);if(h>f.lastFrame){h=f.lastFrame}else{if(h<f.firstFrame){h=f.firstFrame}}a(h);f.currentFrame=h;g.scianimator("drawImage",f.currentFrame);g.scianimator("hilightCurrent");return g},loopMode:function(){a("loop mode");var i=e(this);var h=i.data("scianimator");var f=h.settings.loopMode;if(c.LOOP_MODE_NONE===h.settings.loopMode){h.settings.loopMode=c.LOOP_MODE_LOOP}else{if(c.LOOP_MODE_LOOP===h.settings.loopMode){h.settings.loopMode=c.LOOP_MODE_SWEEP}else{if(c.LOOP_MODE_SWEEP===h.settings.loopMode){h.direction=c.DIRECTION_FORWARD;h.settings.loopMode=c.LOOP_MODE_NONE}}}var g=(h.settings.utf8&&h.settings.labels.utf8.loop!==undefined)?h.settings.labels.utf8.loop[h.settings.loopMode]:h.settings.labels.text.loop[h.settings.loopMode];e("#"+h.controls.loop).removeClass(f).addClass(h.settings.loopMode).html(g);a(h.settings.loopMode);return i},speedUp:function(){a("speed up");var g=e(this);var f=g.data("scianimator");f.settings.delay-=f.settings.delayStep;f.settings.delay=(f.settings.delay<f.settings.delayMin)?f.settings.delayMin:f.settings.delay;g.scianimator("calculateDwell");if(c.PLAY_MODE_PLAYING==f.playMode){g.scianimator("stop").scianimator("play")}a("Delay: "+f.settings.delay);return g},speedDown:function(){a("speed down");var g=e(this);var f=g.data("scianimator");f.settings.delay=(f.settings.delay<=f.settings.delayMin)?0:f.settings.delay;f.settings.delay+=f.settings.delayStep;f.settings.delay=(f.settings.delay>f.settings.delayMax)?f.settings.delayMax:f.settings.delay;g.scianimator("calculateDwell");if(c.PLAY_MODE_PLAYING==f.playMode){g.scianimator("stop").scianimator("play")}a("delay: "+f.settings.delay);return g},calculateDwell:function(){a("calculateDwell");var h=e(this);var g=h.data("scianimator");var f=g.settings.delay*g.settings.dwellMultiplier;if(f<g.settings.delayMin){f=g.settings.delayMin}if(f>g.settings.delayMax){f=g.settings.delayMax}g.dwell=f;a("dwell: "+g.dwell);return h},enableDisable:function(l){a("enableDisable");var i=l.state||"toggle";var j=e(this);var h=j.data("scianimator");var k=parseInt(l.frame,10);var f=e("#"+h.controls.navigator+"-"+k);var g=e.inArray(k,h.disabledFrames);switch(i){case"enable":if(g!=-1){a("enable: "+k);h.disabledFrames.splice(g,1);e(f).removeClass("disabled")}break;case"disable":if(g==-1){a("disable: "+k);h.disabledFrames.push(k);e(f).addClass("disabled")}break;case"toggle":default:if(g!=-1){a("enable: "+k);h.disabledFrames.splice(g,1);e(f).removeClass("disabled")}else{a("disable: "+k);h.disabledFrames.push(k);e(f).addClass("disabled")}}a("disabledFrames:"+h.disabledFrames);return j},hilightCurrent:function(){a("hilightCurrent");var h=e(this);var g=h.data("scianimator");var f=g.controls.navigator;var i=f+"-"+g.currentFrame;e("a","#"+f).removeClass("current");e("#"+i,"#"+f).addClass("current")},preload:function(){a("preload images");var h=e(this);var g=h.data("scianimator");h.scianimator("showStatus",{status:g.settings.labels.text.status.preload});g.frames=[];var f=0;e.each(g.settings.images,function(k,j){var i=e("<img />").load(function(){if(++f===g.settings.images.length){h.scianimator("onPreloadComplete")}e(this).unbind()}).error(function(){a("Image failed to load for frame #"+k+" : "+j);h.scianimator("enableDisable",{frame:k,state:"disable"});if(++f===g.settings.images.length){h.scianimator("onPreloadComplete")}e(this).unbind()}).attr("src",j);g.frames.push(i[0])});g.lastFrame=g.frames.length-1;return h},onPreloadComplete:function(){a("onPreloadComplete");var g=e(this);var f=g.data("scianimator");g.scianimator("hideStatus")},showStatus:function(i){a("showStatus");var h=e(this);var g=h.data("scianimator");h.scianimator("hideStatus");var f=e('<div class="status">'+i.status+"</div>");f.hide().appendTo(h).fadeIn("slow");if(i.timeout!==undefined){self.setTimeout(function(){h.scianimator("hideStatus")},parseInt(i.timeout,10))}return h},hideStatus:function(){a("hideStatus");var g=e(this);var f=g.data("scianimator");e(".status",g).fadeOut("slow",function(){e(this).remove()});return g},listImages:function(){a("list images");var g=e(this);var f=g.data("scianimator");return f.settings.images}};function a(f){if(d.debug&&window.console&&window.console.log){window.console.log(f)}}})(jQuery);